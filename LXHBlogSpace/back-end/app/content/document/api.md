## content 模块的API文档

2019-9-28

ver: 1.0



### 上传图片

接口路径：`/api/v1/content/UploadImage`

请求方法：POST，要求携带用户Cookie。请求消息体应为未经编码的原始图片数据。只允许JPEG, PNG, BMP格式的文件


服务端返回：json，包含以下字段

| 键名       | 说明                                                     |
| ---------- | -------------------------------------------------------- |
| "ecode"    | 字符串类型，错误码为 {0  -1}。详见最底部的错误码对照表 |
| "reason"   | 字符串类型，错误原因。                                   |
| "img_path" | 字符串类型。如果上传成功返回图片路径                     |

### 保存草稿

接口路径：`/api/v1/content/SaveDraft`

请求方法：POST，要求携带用户Cookie。请求消息体应为`application/x-www-form/urlencoded`类型，包含以下参数：

| 参数名   | 说明                                                         |
| -------- | ------------------------------------------------------------ |
| draft_id | 草稿的id，如果是新创建则可以省略此参数或填空                 |
| bg       | 背景图片的url，应当使用URI编码                               |
| imgs     | 一个经过json.stringfiy()的array，包含着上传的图片。应当使用URI编码 |
| title    | 文章的标题，应当使用base64进行编码。文章的标题应当不大于20个字符 |
| content  | 文章内容，应当使用base64进行编码。文章的字符数应当不大于50000字 |

服务端返回：json，包含以下字段

| 键名     | 说明                      |
| -------- | ------------------------- |
| "ecode"  | 字符串类型，错误码为 {0  -2  -3  -4}。详见最底部的错误码对照表 |
| "reason" | 字符串类型，错误原因。 |
| "draft_id" | 文章id |



### 读取草稿

接口路径：`/api/v1/content/ReadDraft`

请求方法：GET，要求携带用户Cookie。请求参数为以下参数：

| 参数名     | 说明           |
| ---------- | -------------- |
| "draft_id" | 欲读取草稿的id |

服务端返回：json，包含以下字段

| 键名      | 说明                                                         |
| --------- | ------------------------------------------------------------ |
| "ecode"   | 字符串类型，错误码为 {0  -4 \|5}。详见最底部的错误码对照表 |
| "reason"  | 字符串类型，错误原因。?                                       |
| "draft_id" | 文章id                                                       |
| "lastmodify_time" | 上次保存的unix时间戳 |
| "bg"    | 背景图片的url，应当使用URI编码                               |
| "imgs"   | ?一个经过json.stringfiy()的array，包含着上传的图片。使用URI编码 |
| "title"  | 文章的标题，使用base64进行编码。 |
| "content" | 文章内容，使用base64进行编码。 |

### 获取用户的草稿列表

接口路径：`/api/v1/content/GetDraftList`

请求方法：GET，要求携带用户Cookie。

服务端返回：JSON.stringify()的数组，每个元素为一个JSON对象，保存时间距现在越近的在数组的位置越靠前。JSON对象包含着以下字段

| 键名              | 说明               |
| ----------------- | ------------------ |
| "draftid"         | 草稿的ID           |
| "title"           | 草稿的标题         |
| "content"         | 草稿内容的前30个字 |
| "lastmodify_date" | 上次保存的时间     |

### 删除草稿

接口路径：`/api/v1/content/DeleteDraft`

请求方法：POST，要求携带用户Cookie，并提交以下参数：

| 参数名   | 说明           |
| -------- | -------------- |
| draft_id | 要删除的草稿id |

服务端返回：json。包含以下字段

| 键名     | 说明                                                         |
| -------- | ------------------------------------------------------------ |
| "ecode"  | 字符串类型，错误码为 {0 \|4 \|5}。详见最底部的错误码对照表 |
| "reason" | 字符串类型，错误原因。                                       |

### 发表文章

接口路径：`/api/v1/content/PublishArticle`

请求方法：POST，要求携带用户Cookie。请求消息体应为`application/x-www-form/urlencoded`类型，包含以下参数：

| 参数名     | 说明                                                         |
| ---------- | ------------------------------------------------------------ |
| article_id | 文章的id，如果是新创建则可以省略此参数或填空                 |
| bg         | 背景图片的url，应当使用URI编码                               |
| title      | 文章的标题，应当使用base64进行编码。文章的标题应当不大于20个字符 |
| content    | 文章内容，应当使用base64进行编码。文章的字符数应当不大于10000字 |

服务端返回：json，包含以下字段

| 键名         | 说明                                                         |
| ------------ | ------------------------------------------------------------ |
| "ecode"      | 字符串类型，错误码为 {0 \|2 \|3 \|4}。详见最底部的错误码对照表 |
| "reason"     | 字符串类型，错误原因。                                       |
| "article_id" | 文章id                                                       |

### 获取文章数据

接口路径：`/api/v1/content/GetArticleContent`

请求方法：GET，请求参数为以下参数：

| 参数名       | 说明           |
| ------------ | -------------- |
| "article_id" | 欲读取文章的id |

服务端返回：json，包含以下字段

| 键名              | 说明                                                       |
| ----------------- | ---------------------------------------------------------- |
| "ecode"           | 字符串类型，错误码为 {0 \|4 \|5}。详见最底部的错误码对照表 |
| "reason"          | 字符串类型，错误原因。                                     |
| "article_id"      | 文章id                                                     |
| "author"          | 作者用户名                                                 |
| "lastmodify_time" | 上次保存的unix时间戳                                       |
| "bg"              | 背景图片的url，应当使用URI编码                             |
| "title"           | 文章的标题，使用base64进行编码。                           |
| "content"         | 文章内容，使用base64进行编码。                             |
| "vote_num"        | 赞数                                                       |
| "comment_num"     | 评论数                                                     |

### 删除文章

接口路径：`/api/v1/content/DeleteArticle`

请求方法：POST，要求携带用户Cookie，并包含以下参数

| 参数名     | 说明           |
| ---------- | -------------- |
| article_id | 要删除的草稿id |

服务端返回：json。包含以下字段

| 键名     | 说明                                                     |
| -------- | -------------------------------------------------------- |
| "ecode"  | 字符串类型，错误码为 {0 \|5}。详见最底部的错误码对照表 |
| "reason" | 字符串类型，错误原因。                                   |

### 获取某用户的文章列表

接口路径：`/api/v1/content/GetUserArticleList`

请求方法：GET，并包含以下参数

| 参数名   | 说明           |
| -------- | -------------- |
| username | 要查询的用户名 |

服务端返回：一个stringify的数组。每个元素为json。包含以下字段。如果未查询到则为空数组[]

| 字段名        | 说明                                 |
| ------------- | ------------------------------------ |
| "aritcle_id"  | 文章id                               |
| "title"       | 文章的标题                           |
| "brief"       | 文章内容的简要，为文章内容的前30个字 |
| "create_date" | 创建时间的unix时间戳，精确到秒       |
| "vote_num"    | 赞数                                 |
| "comment_num" | 评论数                               |
| "author"      | 作者的用户名                         |



### 点赞文章

接口路径：`/api/v1/content/vote`

请求方法：POST，要求携带用户Cookie，并包含以下参数

| 参数名     | 说明                                               |
| ---------- | -------------------------------------------------- |
| action     | 是否取消点赞，"cancle"为取消点赞，"vote"为进行点赞 |
| article_id | 要操作的文章                                       |

服务端返回：json，包含以下字段

| 键名     | 说明                                                   |
| -------- | ------------------------------------------------------ |
| "ecode"  | 字符串类型，错误码为 {0  -4}。详见最底部的错误码对照表 |
| "reason" | 字符串类型，错误原因。                                 |

### 收藏文章

接口路径：`/api/v1/content/subscribe`

请求方法：POST，要求携带用户Cookie，并包含以下参数

| 参数名     | 说明                                                |
| ---------- | --------------------------------------------------- |
| action     | 是否取消收藏，"cancle"为取消收藏，"subscribe"为收藏 |
| article_id | 要操作的文章                                        |

服务端返回：json，包含以下字段

| 键名     | 说明                                                      |
| -------- | --------------------------------------------------------- |
| "ecode"  | 字符串类型，错误码为 {0  -4 -5}。详见最底部的错误码对照表 |
| "reason" | 字符串类型，错误原因。                                    |

### 读取我的收藏

接口路径：`/api/v1/content/GetSubscribedList`

请求方法：GET，要求携带用户Cookie

服务端返回：数组，每个元素为一个json，包含以下字段

| 字段名     | 说明           |
| ---------- | -------------- |
| article_id | 文章的id       |
| title      | 文章的标题     |
| author     | 作者           |
| avatar     | 作者的头像     |
| add_time   | 添加收藏的时间 |



### 查询当前用户可对文章进行的操作

接口路径：`/api/v1/content/checkUserOperation`

请求方法：GET，要求携带用户Cookie，并包含以下参数

| 参数名     | 说明         |
| ---------- | ------------ |
| article_id | 要操作的文章 |

服务端返回：json，包含以下字段

| 键名            | 说明                                                      |
| --------------- | --------------------------------------------------------- |
| "ecode"         | 字符串类型，错误码为 {0  -4 -5}。详见最底部的错误码对照表 |
| "reason"        | 字符串类型，错误原因。                                    |
| "can_vote"      | 字符串类型, "0"为已经点赞过, "1"为可点赞                  |
| "can_subscribe" | 字符串类型, "0"为已经收藏过, "1"为可收藏                  |
| "isAuthor"      | 字符串类型, "1"为文章作者                                 |

### 发送评论

发送评论至文章，并推送至接收者的消息提示中。暂时不实现回复功能

接口路径：`/api/v1/content/SendComment`

请求方法：POST，要求携带用户Cookie，并包含以下参数

| 参数名     | 说明                     |
| ---------- | ------------------------ |
| article_id | 要操作的文章             |
| content    | 评论内容，使用base64编码 |

服务端返回：json，包含以下字段

| 键名     | 说明                                                      |
| -------- | --------------------------------------------------------- |
| "ecode"  | 字符串类型，错误码为 {0  -4 -5}。详见最底部的错误码对照表 |
| "reason" | 字符串类型，错误原因。                                    |

### 获取文章的评论

接口路径：`/api/v1/content/GetComments`

请求方法：GET，包含以下参数

| 参数名     | 说明         |
| ---------- | ------------ |
| article_id | 要操作的文章 |
| page       | 请求的页数   |

服务端返回：json，包含以下字段。如果页数有误则pageNum返回-1。unixtimestamp精确到秒。每一页的最大评论数为5条。comment使用base64进行编码

```json
{"pageNum": 1, "maxPageNum": 4, "commentList": [{"username": "test1", "avatar": "lxhcat.jpg", "re": "Lxh", "comment": "test comment", "time": "2019-02-32"},
{"username": "test1", "avatar": "lxhcat.jpg", "re": "", "comment": "test comment", "time": "unixtimestamp"},
{"username": "test1", "avatar": "lxhcat.jpg", "re": "", "comment": "test comment", "time": "unixtimestamp"},
{"username": "test1", "avatar": "lxhcat.jpg", "re": "", "comment": "test comment", "time": "unixtimestamp"},
{"username": "test1", "avatar": "lxhcat.jpg", "re": "", "comment": "test comment", "time": "unixtimestamp"},
{"username": "test1", "avatar": "lxhcat.jpg", "re": "", "comment": "test comment", "time": "unixtimestamp"}]
```

### 获取文章推送列表

接口路径：`/api/v1/content/GetComments`

请求方法：GET，包含以下参数

| 参数名     | 说明                       |
| ---------- | -------------------------- |
| article_id | 上次查询的最后一个文章的id |

服务端返回：经stringify的数组。每次请求最多返回15条文章信息。每个元素为一个json，包含以下字段。

```json
{"article_id": 12450, "title": "文章标题1", "brief": "简要1", "create_date": 114514, "tags": [id1, id2], "interInfo": {"vote": 123, "comments": 123}, "authorInfo":{"name": "user", "avatar": "xxxxx"}}
```

### 获取时间线推送列表



### 获取友情链接

接口路径：`/api/v1/content/GetFriendLink`

请求方法：GET

服务端返回：

### 错误码对照表

| 错误码 | 原因                                            |
| ------ | ----------------------------------------------- |
| 0      | 操作成功                                        |
| -1     | 文件格式错误，只接受png，jpg，以及bmp格式的图片 |
| -2     | 请求参数有误                                    |
| -3     | 文章标题或内容过长                              |
| -4     | 指定草稿/文章不存在                             |
| -5     | 请求参数有误                                    |

