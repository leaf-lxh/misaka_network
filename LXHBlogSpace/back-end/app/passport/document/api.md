## passport 的API文档

2019-9-22

ver 1.0

- note1:  编码默认使用UTF8编码，对于其他编码，服务器暂未实现其支持

- note2: 

~~为了防止监听，导致明文密码泄露，决定在传输前将密码进行MD5算法处理。~~

**服务应当使用HTTPS协议**。密码的传输，需确保内网环境的安全（比如使用阿里云的安全组功能）

对于HTTPS协议的中间人攻击防御，交给浏览器和用户处理。

### 用户登录

接口路径：`/api/v1/passport/login`

请求方法：`POST`

请求消息体：应包含以下信息，以`键名1=值&键名2=值&键名3=值`的形式组合

| 键名     | 说明   | 例子 |
| -------- | ------ | ---- |
| username | 用户名 | leaf |
| password | 密码   |      |

服务端返回：

如果登录成功将返回302状态码，并进行set-cookie

失败则状态码为200，返回 JSON，包含以下数据

| 键名     | 说明                            | 例子     |
| -------- | ------------------------------- | -------- |
| "ecode"  | 整数型的错误码，无错误发生时为0 | 0        |
| "reason" | 原因，字符串类型                | 密码错误 |

### 用户注册

接口路径：`/api/v1/passport/register`

请求方法：`POST`

请求消息体：应包含以下信息, 以`键名1=值&键名2=值&键名3=值`的形式组合。服务端支持urlencode

| 键名     | 说明 | 例子                            |
| -------- | ---- | ------------------------------- |
| username | 用户名，小于10个字符, 并且唯一 | leaf |
| password | 密码，长度为8-15位，需为字母和数字的组合，可添加下划线 |  |
| email | 邮箱，长度小于30，暂时只支持**腾讯，网易，新浪，谷歌邮箱** | abc@def.com |
| vcode | 邮箱认证码 | 124500 |

服务端返回：

返回200状态+JSON，包含以下数据。如果注册成功ecode为0，reason为注册成功。

| 键名     | 说明                            | 例子     |
| -------- | ------------------------------- | -------- |
| "ecode"  | 整数型的错误码，无错误发生时为0 | 0        |
| "reason" | 原因，字符串类型                | 注册成功 |



### 找回密码

### 检查用户是否存在

接口路径：`/api/v1/passport/CheckUserExist`

请求方法：`GET`

请求消息体：应包含以下信息

| 键名     | 说明   | 例子 |
| -------- | ------ | ---- |
| username | 用户名 | leaf |

服务端返回：json，包含以下项。

| 键名    | 说明                          | 例子   |
| ------- | ----------------------------- | ------ |
| "exist" | 存在为"true", 不存在为"false" | "true" |



### 检查邮箱是否已注册

接口路径：`/api/v1/passport/CheckEmailExist`

请求方法：`GET`

请求消息体：应包含以下信息

| 键名  | 说明 | 例子 |
| ----- | ---- | ---- |
| email | 邮箱 | leaf |

服务端返回：json，包含以下项。

| 键名    | 说明                          | 例子   |
| ------- | ----------------------------- | ------ |
| "exist" | 存在为"true", 不存在为"false" | "true" |



### 发送邮件验证码

接口路径：`/api/v1/passport/SendEmailAuth`

请求方法：`POST`

请求消息体：应包含以下信息, 以`键名1=值&键名2=值&键名3=值`的形式组合。服务端支持urlencode

为了安全起见，**邮件验证码为8位，有效期为2分钟**

| 键名         | 说明             | 例子        |
| ------------ | ---------------- | ----------- |
| email        | 用户邮箱地址     | abc@def.com |
| verification | 验证码，暂未实现 | ABCD        |

服务端返回：json，包含以下项。

| 键名     | 说明                            | 例子         |
| -------- | ------------------------------- | ------------ |
| "ecode"  | 整数型的错误码，无错误发生时为0 | -3           |
| "reason" | 原因，字符串类型                | 邮箱格式有误 |

### 检查当前用户是否登录

校验cookie中的token和uuid是否匹配，如果是将继续检查token是否有效

接口路径：`/api/v1/passport/IsLogin`

请求方法：`GET`

服务端返回：JSON，包含以下键

| 键名        | 说明           | 例子                                                    |
| ----------- | -------------- | ------------------------------------------------------- |
| "vaild"     | 是否有效       | 有效为"true"。无效则为"false"，同时下面的数据将不会返回 |
| "username"  | 用户名称       | “leaf"                                                  |
| "avatar"    | 用户头像的url  | "https://static.leaflxh.com/avatar/xxxx.jpg"            |
| "is_locked" | 用户是否被锁定 | 0为未锁定，1为锁定                                      |

### 获取用户基础信息

接口路径：`/api/v1/passport/GerUserInfo`，需包括以下参数

| 参数     | 说明             |
| -------- | ---------------- |
| username | 欲查询的用户名。 |

请求方法：`GET`

服务端返回：JSON，包含以下键

| 键名            | 说明               | 例子                                         |
| --------------- | ------------------ | -------------------------------------------- |
| "ecode"         | 错误码             | 无错误为0，错误码为{0/ -1/ -10}              |
| "reason"        | 错误信息           | 如果发生错误，将不会返回以下数据             |
| "username"      | 用户名称           | “leaf"                                       |
| "avatar"        | 用户头像的url      | "https://static.leaflxh.com/avatar/xxxx.jpg" |
| "register_date" | 用户注册日期       | unix时间戳                                   |
| "description"   | 用户的描述         | 字符串                                       |
| "is_locked"     | 用户是否被锁定     | 0为未锁定，1为锁定                           |
| "current_user"  | 是否为当前登录用户 | "true"/"false"                               |

### 更新用户信息

接口路径：`/api/v1/passport/UpdateUserDetails`

请求方法：POST，需包含以下参数

| 参数        | 说明           |
| ----------- | -------------- |
| avatar_path | 头像的图片地址 |
| desciption  | 简介           |

服务端返回：JSON，包含以下键

| 键名     | 说明         |
| -------- | ------------ |
| "ecode"  | 错误码，{0 } |
| "reason" | 错误信息     |



### 错误码对照表

错误码为`0`代表无错误发生

| 错误码 | 说明（对应的原因）           |
| ------ | ---------------------------- |
| -1     | 请求参数有误                 |
| -2     | 用户名或密码错误             |
| -3     | 邮箱格式有误                 |
| -4     | 邮箱提供商暂不支持           |
| -5     | 用户名格式有误               |
| -6     | 密码格式有误                 |
| -7     | 提供的邮件验证码无效或已过期 |
| -8     | 此用户名已被占用             |
| -9     | 此邮箱已被占用               |
| -10    | 欲查询用户不存在             |